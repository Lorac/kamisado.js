"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function isDigit(e){return"0123456789".indexOf(e)!==-1}function algebraic(e){var r=file(e),t=rank(e);return"abcdefgh".substring(r,r+1)+"87654321".substring(t,t+1)}function rank(e){return e>>4}function file(e){return 15&e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(r,t,o){return t&&e(r.prototype,t),o&&e(r,o),r}}(),BLACK="b",WHITE="w",BOARD={a8:"o",b8:"b",c8:"p",d8:"k",e8:"y",f8:"r",g8:"g",h8:"m",a7:"r",b7:"o",c7:"k",d7:"g",e7:"b",f7:"y",g7:"m",h7:"p",a6:"g",b6:"p",c6:"o",d6:"r",e6:"p",f6:"m",g6:"y",h6:"b",a5:"k",b5:"p",c5:"b",d5:"o",e5:"m",f5:"g",g5:"r",h5:"y",a4:"y",b4:"r",c4:"g",d4:"m",e4:"o",f4:"b",g4:"p",h4:"k",a3:"b",b3:"y",c3:"m",d3:"p",e3:"r",f3:"o",g3:"k",h3:"g",a2:"p",b2:"m",c2:"y",d2:"b",e2:"g",f2:"k",g2:"o",h2:"r",a1:"m",b1:"g",c1:"r",d1:"y",e1:"k",f1:"p",g1:"b",h1:"o"},PIECE_OFFSETS=[-15,-30,-45,-60,-75,-90,-105,15,30,45,60,75,90,105,-16,-32,-48,-64,-80,-96,-112,16,32,48,64,80,96,112,-17,-34,-51,-68,-85,-102,-119,17,34,51,58,85,102,119],SQUARES={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},SYMBOLS="obpkyrgmOBPKYRGM",Kamisado=function(){function e(r){_classCallCheck(this,e);var t="OBPKYRGM/8/8/8/8/8/8/mgrykpbo b 1";"undefined"==typeof r?this.load(t):this.load(r)}return _createClass(e,[{key:"clear",value:function(){this.board=new Array(128),this.turn=BLACK,this.moveNumber=1,this.history=[]}},{key:"load",value:function(e){var r=e.split(/\s+/),t=r[0],o=0;this.clear();for(var n=0;n<t.length;n++){var a=t.charAt(n);"/"===a?o+=8:isDigit(a)?o+=parseInt(a,10):(this._put({color:a,player:a<"a"?BLACK:WHITE},algebraic(o)),o++)}return this.turn=r[1],this.moveNumber=parseInt(r[2],10),!0}},{key:"move",value:function(e){var r=null;if("string"==typeof e)r=this._moveFromSan(e);else if("object"===("undefined"==typeof e?"undefined":_typeof(e)))for(var t=this._generateLegalMoves(),o=0,n=t.length;o<n;o++)if(e.from===algebraic(t[o].from)&&e.to===algebraic(t[o].to)){r=t[o];break}return r?(this._makeMove(r),r):null}},{key:"turn",value:function(){return this.turn}},{key:"ascii",value:function(){for(var e="   +------------------------+\n",r=SQUARES.a8;r<=SQUARES.h1;r++){if(0===file(r)&&(e+=" "+"87654321"[rank(r)]+" |"),null==this.board[r])e+=" . ";else{var t=this.board[r].piece,o=this.board[r].player,n=o===BLACK?t.toUpperCase():t.toLowerCase();e+=" "+n+" "}r+1&136&&(e+="|\n",r+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h\n"}},{key:"_moveFromSan",value:function(e){for(var r=this._generateLegalMoves(),t=0,o=r.length;t<o;t++)if(e===this._moveToSan(r[t]))return r[t];return null}},{key:"_moveToSan",value:function(e){return"object"===("undefined"==typeof e?"undefined":_typeof(e))?e.piece+e.to:null}},{key:"_buildMove",value:function(e,r,t){var o={player:this.turn,from:algebraic(r),to:algebraic(t),piece:e[r].piece};return o}},{key:"_generateLegalMoves",value:function(){for(var e=[],r=this.turn,t=this.moveNumber,o=this.history[t-1],n=SQUARES.a8,a=SQUARES.h1,i=n;i<=a;i++)if(136&i)i+=7;else{var u=this.board[i];if(null!=u&&u.player===r&&("undefined"==typeof o||this._get(o.move.to).toLowerCase()===this._get(algebraic(i)).piece.toLowerCase()))for(var f=0,l=PIECE_OFFSETS.length;f<l;f++){var s=PIECE_OFFSETS[f],h=i;if(u.player===BLACK&&s>0||u.player===WHITE&&s<0)for(;;){if(h+=s,136&h)break;if(null==this.board[h]){e.push(this._buildMove(this.board,i,h));break}}}}return e}},{key:"_makeMove",value:function(e){this._push(e),this.board[SQUARES[e.to]]=this.board[SQUARES[e.from]],this.board[SQUARES[e.from]]=null,this.turn===WHITE&&this.moveNumber++,this.turn=this._swapColor(this.turn)}},{key:"_swapColor",value:function(e){return e===WHITE?BLACK:WHITE}},{key:"_push",value:function(e){this.history.push({move:e,turn:this.turn,moveNumber:this.moveNumber})}},{key:"_generateFen",value:function(){for(var e=0,r="",t=SQUARES.a8;t<=SQUARES.h1;t++){if(null==this.board[t])e++;else{e>0&&(r+=e,e=0);var o=this.board[t].player,n=this.board[t].piece;r+=o===WHITE?n.toUpperCase():n.toLowerCase()}t+1&136&&(e>0&&(r+=e),t!==SQUARES.h1&&(r+="/"),e=0,t+=8)}return[r,this.turn,this.moveNumber].join(" ")}},{key:"_get",value:function(e){return this.board[SQUARES[e]]}},{key:"_put",value:function(e,r){if(SYMBOLS.indexOf(e.color.toLowerCase())===-1)return!1;if(!(r in SQUARES))return!1;var t=SQUARES[r];return this.board[t]={color:BOARD[r],piece:e.color,player:e.player},!0}},{key:"_remove",value:function(e){var r=this.get(e);return this.board[SQUARES[e]]=null,r}}]),e}();